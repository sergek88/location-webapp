<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <title>Определяем ваше местоположение…</title>
  <style>
    body { font-family: Arial; text-align: center; padding: 40px; }
  </style>
</head>
<body>
  <h2>Определяем ваше местоположение...</h2>
  <p id="status">Пожалуйста, разрешите доступ к геолокации.</p>

  <script>
    async function sendToWebhook(data) {
      await fetch("https://n8nast.ru/webhook/geo", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify(data),
      });
      Telegram.WebApp.close();
    }

    function fallbackToTelegram() {
      sendToWebhook({ request_location_via_telegram: true });
    }

    navigator.geolocation.getCurrentPosition(
      pos => {
        sendToWebhook({
          latitude: pos.coords.latitude,
          longitude: pos.coords.longitude
        });
      },
      err => {
        fallbackToTelegram();  // если не работает → просим гео в телеграм
      }
    );
  </script>
</body>
</html>
